
!function(){function e(e,t){return e.indexOf(t)>-1}function t(e,t){var n=!0;(function r(e){var i,s;if(!n)return;if(t(e)===!1)n=!1;else for(i=0;i<e.children.length;i++)s=e.children[i],r(s)})(e)}function n(e,t){var n,r,i;while(e){if(t(e)===!1)return;for(n=0;n<e.children.length;n++){r=e.children[n];if(t(r)===!1)return}e=e.parent}}function r(t,n,r){var i=[],s=function(t){var r=t.id,s;if(!e(i,r)){s=n.call(t,t),i.push(r);if(s===!1)return s}},o,u;r(t,s)}function i(e){var t=e.parent,n,r;for(r=0;r<t.children.length;r++){n=t.children[r];if(n===e)return t.children.splice(r,1).shift()}}function s(e,t){return t=t||"/",e?[e.id,e.children.length].join(t):"0"}function o(e,t,n){this.depth=e?e.depth+1:0,this.data=t||{},this.parent=e||null,this.id=n||s(e),this.children=[]}o.parse=function(e,t){var n,r=function(e){var n,r={};for(n in e)n!==t&&(r[n]=e[n]);return r};return function i(e,s){var u,a;s?(u=new o(s,r(e)),s.children.push(u)):u=n=new o(null,r(e));if(t in e)for(a=0;a<e[t].length;a++)i(e[t][a],u)}(e),n},o.prototype.appendChild=function(e,t){var n=new o(this,e,t);return this.children.push(n),this},o.prototype.removeChild=function(e){if(typeof e=="number"&&this.children[e])return this.children.splice(e,1).shift();if(e instanceof o)return i(e);throw new Error("Invalid argument "+e)},o.prototype.remove=function(){return i(this)},o.prototype.root=function(){var e=this;if(!e.parent)return this;while(e.parent)e=e.parent;return e},o.prototype.isRoot=function(){return!this.parent},o.prototype.traverseUp=function(e){r(this,e,n)},o.prototype.traverseDown=function(e){r(this,e,t)},o.prototype.toString=function(){var e=[];return this.traverseDown(function(t){var n="|- ",r="",i;if(t.depth===0){e.push(t.id);return}for(i=0;i<t.depth;i++)r+=" ";e.push(r+n+t.id)}),e.join("\n")},o.prototype.find=function(e){var t=null,n=typeof e=="function"?e:function(n){if(n.id===e)return t=n,!1};return this.traverseDown(function(e){if(n.call(this,e))return t=e,!1}),t},o.prototype.path=function(e,t){t=t||"/",e[0]===t&&(e=e.substring(1));var n=e.split(t),r=null,i=this,s;for(s=0;s<n.length;s++)r=parseInt(n[s],10),i=i.children.length&&i.children.length>r?i.children[r]:null;return i},o.prototype.toArray=function(){var e=[];return this.traverseDown(function(t){e.push(t)}),e},o.prototype.__defineGetter__("length",function(){return this.toArray().length}),typeof module!="undefined"&&module.exports?module.exports=o:this.Arboreal=o}(this)